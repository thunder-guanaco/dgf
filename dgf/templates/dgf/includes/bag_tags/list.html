{% load dgf i18n mathfilters %}

<div class="content">
    {% for friend in friends %}
        <div class="line">

            {% with bag_tag_difference=friend.bag_tag|sub:friend.previous_bag_tag %}

                <div class="news-best" data-bag-tag-difference="{{bag_tag_difference}}">
                </div>

                <div class="news
                        {% if bag_tag_difference < 0 %}
                            positive
                        {% elif bag_tag_difference > 0 %}
                            negative
                        {% elif bag_tag_difference == 0 %}
                            neutral
                        {% else %}
                            none
                        {% endif %}">
                    <span>{{bag_tag_difference|abs}}</span>
                </div>

            {% endwith %}

            {% if request.user.is_authenticated and request.user.friend.bag_tag %}

                <div class="number clickable"
                     data-bag-tag="{{friend.bag_tag}}"
                     data-username="{{friend.username}}"
                     data-url="{% url 'dgf:bag_tag_claim' friend.bag_tag %}"
                     onclick="bagTagClicked({{friend.bag_tag}})">
                    <span>{{friend.bag_tag}}</span>
                </div>
                <div class="player clickable"
                     data-bag-tag="{{friend.bag_tag}}"
                     data-username="{{friend.username}}"
                     onclick="bagTagClicked({{friend.bag_tag}})">
                    {% include "dgf/includes/friend_ball.html" with friend=friend %}
                    <div>
                        {{friend.short_name}}
                    </div>
                </div>

            {% else %}

                <div class="number">
                    <span>{{friend.bag_tag}}</span>
                </div>
                <div class="player">
                    {% include "dgf/includes/friend_ball.html" with friend=friend %}
                    <div>
                        {{friend.short_name}}
                    </div>
                </div>

            {% endif %}

            <div class="since" onclick="switchStatistics({{friend.bag_tag}})">
                {% if not request.user_agent.is_mobile and friend.since %}
                    {% blocktranslate with date=friend.since|date days=friend.since|days_since %}Since {{date}} ({{days}} days){% endblocktranslate %}
                {% endif %}
                <span class="statistics-button closed"
                     data-bag-tag="{{friend.bag_tag}}">
                </span>
            </div>
        </div>
        {% if friend.since %}
            <div class="statistics"
                 data-bag-tag="{{friend.bag_tag}}"
                 style="display: none;">
                {% if request.user_agent.is_mobile %}
                    <span>⏱&nbsp;{% blocktranslate with date=friend.since|date days=friend.since|days_since %}Since {{date}} ({{days}} days){% endblocktranslate %}</span>
                {% endif %}
                {% if friend.bag_tag_changes_count > 0 %}
                    <span>👍️&nbsp;{% trans "Best:" %} {{friend.best_bag_tag}}</span>
                    <span>👎&nbsp;{% trans "Worst:" %} {{friend.worst_bag_tag}}</span>
                    <span>👉&nbsp;{% trans "Average:" %} {{friend.average_bag_tag|floatformat:0}}</span>
                    <span>🫴&nbsp;{% trans "Most received:" %} {{friend.most_received_bag_tag}}</span>
                {% endif %}
                <span>🔄&nbsp;{% blocktranslate count changes=friend.bag_tag_changes_count %}1 bag tag change{% plural %}{{changes}} bag tag changes{% endblocktranslate %}</span>
                <span>1️⃣&nbsp;{% blocktranslate with first_change=friend.first_bag_tag_change|date %}Got their first bag tag on {{first_change}}{% endblocktranslate %}</span>
            </div>
        {% endif %}
    {% endfor %}
</div>
