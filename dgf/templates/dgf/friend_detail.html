{% extends 'base.html' %}
{% load static i18n dgf %}

{% block title %}
    {{friend.full_name}}
{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/friend_detail.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/grt-youtube-popup.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/show-all-less.css' %}">
{% endblock %}

{% block style %}
    {% include "dgf/includes/background.html" with friend=friend %}
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{% static 'js/grt-youtube-popup.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/friend_video.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/show-all-less.js' %}"></script>
    <script type="text/javascript">
        $(window).on("load", function() {
            $("a[href='/friends/']").parent().addClass("ancestor");
        });
    </script>
{% endblock %}

{% block content %}

    <div id="friend" class="contains-pdga-attribution">

        <div id="friend-picture">
            {% include "dgf/includes/friend_picture.html" with friend=friend img_size="150" font_size="50" clickable=True %}
        </div>
        <div id="friend-info">
            <div id="friend-header">
                <h1>
                    <div>
                        {{friend.full_name}}

                        {% if friend.sponsor_logo %}
                            {% if friend.sponsor_link %}
                                <a href="{{friend.sponsor_link}}" target="_blank">
                                    <img src="/media/{{friend.sponsor_logo}}" class="avatar-img" width="50px" height="50px"/>
                                </a>
                            {% else %}
                                    <img src="/media/{{friend.sponsor_logo}}" class="avatar-img" width="50px" height="50px"/>
                            {% endif %}
                        {% endif %}
                    </div>

                    {% if friend.id == request.user.friend.id %}
                        <a class="desktop edit-button" href="{% url 'dgf:friend_update' %}">
                            <button>
                                {% trans 'Update profile' %}
                            </button>
                        </a>
                        <a class="desktop edit-button" href="{% url 'dgf:tournament_index' %}">
                            <button>
                                {% trans 'Update tournaments' %}
                            </button>
                        </a>
                    {% endif %}
                </h1>
                {% if friend.id == request.user.friend.id %}
                    <a class="mobile edit-button" href="{% url 'dgf:friend_update' %}">
                        <button>
                            {% trans 'Update profile' %}
                        </button>
                    </a>
                    <a class="mobile edit-button" href="{% url 'dgf:tournament_index' %}">
                        <button>
                            {% trans 'Update tournaments' %}
                        </button>
                    </a>
                {% endif %}
                {% if friend.sponsor %}
                    <div class="larger">
                        {% if friend.sponsor_link %}
                            <p>{% trans "Sponsored by" %} <a href="{{friend.sponsor_link}}" target="_blank">{{friend.sponsor}}</a></p>
                        {% else %}
                            <p>{% trans "Sponsored by" %} {{friend.sponsor}}</p>
                        {% endif %}
                    </div>
                {% endif %}
                {% if friend.club_role %}
                    <div class="larger">
                        <p>{{friend.club_role}}</p>
                    </div>
                {% endif %}
                <div class="friend-header-line desktop">
                    {% if friend.city %}
                        <p>{% trans "from" %} {{friend.city}}</p>
                    {% endif %}
                    {% if friend.gt_number %}
                        <p class="external-ids"><b>GT </b><b><a href="https://rating.discgolf.de/detail.php?gtn={{friend.gt_number}}" target="_blank">#{{friend.gt_number}}</a></b></p>
                    {% endif %}
                    {% if friend.pdga_number %}
                        <p class="external-ids"><b>PDGA </b><b><a href="https://pdga.com/player/{{friend.pdga_number}}" target="_blank">#{{friend.pdga_number}}</a></b></p>
                    {% endif %}
                </div>
                <div class="friend-header-line mobile">
                    {% if friend.city %}
                        <p>{% trans "from" %} {{friend.city}}</p>
                    {% endif %}
                </div>
                <div class="friend-header-line mobile">
                    {% if friend.gt_number %}
                        <p class="external-ids"><b>GT <a href="https://rating.discgolf.de/detail.php?gtn={{friend.gt_number}}" target="_blank">#{{friend.gt_number}}</a></b></p>
                    {% endif %}
                    {% if friend.pdga_number %}
                        <p class="external-ids"><b>PDGA <a href="https://pdga.com/player/{{friend.pdga_number}}" target="_blank">#{{friend.pdga_number}}</a></b></p>
                    {% endif %}
                </div>
                <hr>
                <div class="friend-header-line">
                    {% if friend.division %}
                        <div class="division">
                            <label>{% trans "Division" %} </label>
                            <div>{{friend.division.id}}</div>
                        </div>
                    {% endif %}
                    {% if friend.rating %}
                        <div class="rating">
                            <label>{% trans "Rating" %} </label>
                            <div class="ball-container">
                                <div class="ball">
                                    {{friend.rating}}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
            <div id="friend-body">
                {% if friend.plays_since %}
                    <div>
                        <p class="label">{% trans "Plays disc golf since" %}</p>
                        <p class="value">{{friend.plays_since}}</p>
                    </div>
                {% endif %}
                {% with friend.best_score_in_wischlingen as score %}
                    {% if score is not None %}
                        <div>
                            <p class="label">{% trans "Best score in Wischlingen (standard 23 - par 71)" %}</p>
                            <p class="value">{{ score|add:"71" }}
                                {% if score != 0 %}
                                    ({{score|stringformat:"+i"}})
                                {% else %}
                                    (E)
                                {% endif %}
                            </p>
                        </div>
                    {% endif %}
                {% endwith %}
                {% if friend.free_text %}
                    <div>
                        <p class="label">{% trans "Discovered disc golf..." %}</p>
                        <p class="value">{{friend.free_text}}</p>
                    </div>
                {% endif %}
                {% if friend.job %}
                    <div>
                        <p class="label">{% trans "That's what I do when I'm not on the disc golf course" %}</p>
                        <p class="value">{{friend.job}}</p>
                    </div>
                {% endif %}
                {% if friend.hobbies %}
                    <div>
                        <p class="label">{% trans "Other hobbies" %}</p>
                        <p class="value">{{friend.hobbies}}</p>
                    </div>
                {% endif %}
                {% if friend.favorite_courses.count %}
                    <div class="favorite-courses">
                        <p class="label">{% trans "Favorite courses" %}</p>
                        <ul class="value">
                            {% for favorite in friend.favorite_courses.all %}
                                <li>{{favorite.course}}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                {% if friend.highlights.count %}
                    <div class="highlights">
                        <p class="label">{% trans "Highlights" %}</p>
                        <ul class="value">
                            {% for highlight in friend.highlights.all %}
                                <li>&#11088; {{highlight.content}}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
                {% with friend|podium_results as podium_results %}
                    {% if podium_results %}
                        <div class="podiums">
                            <p class="label">{% trans "Tournament achievements" %}</p>
                            <div class="value show-all-less">
                                <div class="top">
                                    {% for result in podium_results|slice:":5" %}
                                        <div>&#12935{{result.position}}; {{result.tournament.name}} [{{result.tournament.date}}]</div>
                                    {% endfor %}
                                </div>
                                <div class="all hidden">
                                    {% for result in podium_results %}
                                        <div>&#12935{{result.position}}; {{result.tournament.name}} [{{result.tournament.date}}]</div>
                                    {% endfor %}
                                </div>
                                {% include "dgf/includes/show-all-less.html" with minimum=5 amount=podium_results.count %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
                {% with friend|now_playing as tournaments %}
                    {% if tournaments %}
                        <div class="now-playing">
                            <p class="label">{% trans "Now playing" %}</p>
                            <ul class="value">
                                {% for tournament in tournaments %}
                                    <li>
                                        <span class="name">{{tournament.name}} </span>
                                        {% if tournament.metrix_id %}
                                            <a href="{{tournament|metrix_url}}" target="_blank" class="name"> → {% trans "follow live" %}</a>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                {% endwith %}
                {% with friend|next_tournaments as tournaments %}
                    {% if tournaments %}
                        <div class="next-tournaments">
                            <p class="label">{% trans "Next tournaments" %}</p>
                            <ul class="value">
                                {% for tournament in tournaments %}
                                    <li>
                                        &#129359;
                                        {% if tournament.url %}
                                            <a href="{{tournament.url}}" target="_blank" class="name">{{tournament.name}} </a>
                                        {% else %}
                                            <span class="name">{{tournament.name}} </span>
                                        {% endif %}
                                        ({{tournament.date}})
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                {% endwith %}
                {% if friend.aces.count %}
                    <div id="aces" class="big-field">
                        <p class="label">{% trans "Aces" %}</p>
                        <div class="value">
                            {% include "dgf/includes/aces_table.html" with aces=friend.aces %}
                        </div>
                        {% with friend.videos.all|filter_by_type:"A"|first as ace_video %}
                            {% if ace_video %}
                                {% include "dgf/includes/youtube_video.html" with youtube_id=ace_video.url|youtube_id %}
                            {% endif %}
                        {% endwith %}
                    </div>
                {% endif %}
                {% if friend.discs.count %}
                    <div id="bag" class="big-field">
                        <p class="label">{% trans "In the bag" %}</p>
                        <div class="value">
                            <div class="table-line">
                                <p>{% trans "Putters" %}</p>
                                <p>{% trans "Mid-ranges" %}</p>
                                <p>{% trans "Fairway drivers" %}</p>
                                <p>{% trans "Distance drivers" %}</p>
                            </div>
                            <hr>
                            <div class="table-line">
                                {% with friend.discs.all as all_discs %}
                                    <div>
                                        {% for disc in all_discs|filter_by_type:"P" %}
                                            <p>{{disc.in_the_bag}}</p>
                                        {% endfor %}
                                    </div>
                                    <div>
                                        {% for disc in all_discs|filter_by_type:"M" %}
                                            <p>{{disc.in_the_bag}}</p>
                                        {% endfor %}
                                    </div>
                                    <div>
                                        {% for disc in all_discs|filter_by_type:"F" %}
                                            <p>{{disc.in_the_bag}}</p>
                                        {% endfor %}
                                    </div>
                                    <div>
                                        {% for disc in all_discs|filter_by_type:"D" %}
                                            <p>{{disc.in_the_bag}}</p>
                                        {% endfor %}
                                    </div>
                                {% endwith %}
                            </div>
                        </div>
                        {% with friend.videos.all|filter_by_type:"B"|first as bag_video %}
                            {% if bag_video %}
                                {% include "dgf/includes/youtube_video.html" with youtube_id=bag_video.url|youtube_id %}
                            {% endif %}
                        {% endwith %}
                    </div>
                {% endif %}
                {% with friend.videos.all|filter_by_type:"O" as other_videos %}
                    {% if other_videos %}
                        <div id="videos" class="big-field">
                            <p class="label">{% trans "Videos" %}</p>
                            <div class="value">
                                {% for video in other_videos %}
                                    {% include "dgf/includes/youtube_video.html" with youtube_id=video.url|youtube_id %}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
        {% include "dgf/includes/pdga_attribution.html" %}
    </div>

{% endblock %}
