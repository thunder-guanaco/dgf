{% load sekizai_tags static i18n dgf %}

{% addtoblock "css" %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/bagtags.css' %}">
{% endaddtoblock %}

{% with request.user.is_authenticated as authenticated %}
    <div id="bagtags">
        <h2>
            {% trans "Bagtags" %}
        </h2>
        <div class="content">
            {% for friend in friends %}
                <div class="line">
                    {% if authenticated and request.user.friend.bagtag %}
                        <div class="number clickable" onclick="claimBagtag({{friend.bagtag}}, '{% url 'dgf:bagtag_claim' friend.bagtag %}')">
                    {% else %}
                        <div class="number">
                    {% endif %}
                        <span>{{friend.bagtag}}</span>
                    </div>
                    <div class="player">
                        {% include "dgf/includes/friend_ball.html" with friend=friend %}
                        <div>
                            {{friend.short_name}}
                        </div>
                    </div>
                    <div class="since desktop">
                        {% trans " seit " %} {{friend.since}}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endwith %}

<script>
    function claimBagtag(number, url) {
        text = "{% trans "Do you claim bagtag number " %}" + number + "?";

        if (confirm(text) == false) {
            return;
        }

        $.ajax({
            type: 'POST',
            url: url,
            beforeSend:function(xhr){
                xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}");
            },
            success: function(response) {
                location.reload();
            },
            error: function(rs, e) {
                console.log(rs.responseText);
                console.log(e);
            }
        });
    }
</script>