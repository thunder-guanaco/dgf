{% load sekizai_tags static i18n dgf %}

{% addtoblock "css" %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/tour_results.css' %}">
{% endaddtoblock %}

{% with instance.tour as tour %}
{% with tour.tournaments.all|order_by:"begin" as tournaments %}
{% with tour|best_results:6 as best_results %}
{% with best_results|all_friends as friends %}

<div id="tour-results">
    <h2>
        {{tour.name}} ({{tour.begin|date:"SHORT_DATE_FORMAT"}} - {{tour.end|date:"SHORT_DATE_FORMAT"}})
    </h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>{% trans "Position" %}</th>
                <th>{% trans "Player" %}</th>
                <th>{% trans "Total" %}</th>
                {% for tournament in tournaments %}
                    <th>{{tournament|ts_number}}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for friend_results in best_results %}
                {% with friends|get_from_dict:friend_results.friend as friend %}
                    <tr>
                        <th>{{forloop.counter}}</th>
                        <th>{% include "dgf/includes/friend_ball.html" with friend=friend show_name=True %}</th>
                        <th>{{friend_results.total_points}}</th>
                        {% for tournament in tournaments %}
                            <td>{{friend_results|get_points_for:tournament}}</td>
                        {% endfor %}
                    </tr>
                {% endwith %}
            {% endfor %}
        </tbody>
    </table>
</div>

{% endwith %}
{% endwith %}
{% endwith %}
{% endwith %}